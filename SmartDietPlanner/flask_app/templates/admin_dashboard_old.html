<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Smart Diet Planner</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body class="dashboard-page">
    
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('admin_dashboard') }}">
                <i class="bi bi-heart-pulse-fill me-2"></i>
                Smart Diet Planner - Admin
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle me-1"></i>
                            {{ session.first_name }} {{ session.last_name }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="{{ url_for('logout') }}">
                                <i class="bi bi-box-arrow-right me-2"></i>Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="container-fluid">
        <div class="row">
            
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if not view %}active{% endif %}" href="{{ url_for('admin_dashboard') }}">
                                <i class="bi bi-speedometer2 me-2"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if view == 'users' %}active{% endif %}" href="{{ url_for('admin_users') }}">
                                <i class="bi bi-people me-2"></i>
                                All Users
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if view == 'daily_logs' %}active{% endif %}" href="{{ url_for('admin_daily_logs') }}">
                                <i class="bi bi-calendar-check me-2"></i>
                                Daily Logs
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if view == 'meal_logs' %}active{% endif %}" href="{{ url_for('admin_meal_logs') }}">
                                <i class="bi bi-egg-fried me-2"></i>
                                Meal Logs
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if view == 'activity_logs' %}active{% endif %}" href="{{ url_for('admin_activity_logs') }}">
                                <i class="bi bi-activity me-2"></i>
                                Activity Logs
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if view == 'goals' %}active{% endif %}" href="{{ url_for('admin_goals') }}">
                                <i class="bi bi-bullseye me-2"></i>
                                User Goals
                            </a>
                        </li>
                        <hr>
                        <li class="nav-item">
                            <a class="nav-link {% if view == 'add_meal' %}active{% endif %}" href="{{ url_for('admin_add_meal') }}">
                                <i class="bi bi-plus-circle me-2"></i>
                                Add Meal
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if view == 'add_activity' %}active{% endif %}" href="{{ url_for('admin_add_activity') }}">
                                <i class="bi bi-plus-circle me-2"></i>
                                Add Activity
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                
                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <div class="mt-3">
                            {% for category, message in messages %}
                                <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}
                
                <!-- Dashboard Overview -->
                {% if not view %}
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Admin Dashboard</h1>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-md-3">
                        <div class="stat-card bg-primary text-white">
                            <div class="stat-icon">
                                <i class="bi bi-people-fill"></i>
                            </div>
                            <div class="stat-details">
                                <h3>{{ stats.total_users }}</h3>
                                <p>Total Users</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-success text-white">
                            <div class="stat-icon">
                                <i class="bi bi-bullseye"></i>
                            </div>
                            <div class="stat-details">
                                <h3>{{ stats.total_goals }}</h3>
                                <p>Total Goals</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-warning text-white">
                            <div class="stat-icon">
                                <i class="bi bi-egg-fried"></i>
                            </div>
                            <div class="stat-details">
                                <h3>{{ stats.total_meals }}</h3>
                                <p>Total Meals</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-info text-white">
                            <div class="stat-icon">
                                <i class="bi bi-activity"></i>
                            </div>
                            <div class="stat-details">
                                <h3>{{ stats.total_activities }}</h3>
                                <p>Total Activities</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Welcome, Admin!</h5>
                                <p class="text-muted">
                                    Use the sidebar to navigate through different sections of the admin panel.
                                    You can view all users, their logs, goals, and manage meals and activities.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- All Users View -->
                {% if view == 'users' %}
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">All Users</h1>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Name</th>
                                        <th>Gender</th>
                                        <th>Weight</th>
                                        <th>Height</th>
                                        <th>Activity Level</th>
                                        <th>Created</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if users %}
                                        {% for user in users %}
                                        <tr>
                                            <td>{{ user[0] }}</td>
                                            <td><strong>{{ user[1] }}</strong></td>
                                            <td>{{ user[2] }}</td>
                                            <td>{{ user[3] }} {{ user[4] }}</td>
                                            <td>{{ user[5] }}</td>
                                            <td>{{ user[6] }} kg</td>
                                            <td>{{ user[7] }} cm</td>
                                            <td><span class="badge bg-info">{{ user[8] }}</span></td>
                                            <td>{{ user[9] }}</td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="9" class="text-center text-muted">No users found</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Daily Logs View -->
                {% if view == 'daily_logs' %}
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Daily Logs</h1>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Username</th>
                                        <th>Date</th>
                                        <th>Calories Consumed</th>
                                        <th>Calories Burned</th>
                                        <th>Water (L)</th>
                                        <th>Sleep (hrs)</th>
                                        <th>Weight (kg)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if daily_logs %}
                                        {% for log in daily_logs %}
                                        <tr>
                                            <td>{{ log[0] }}</td>
                                            <td><strong>{{ log[1] }}</strong></td>
                                            <td>{{ log[2] }}</td>
                                            <td><span class="badge bg-warning">{{ log[3] }}</span></td>
                                            <td><span class="badge bg-danger">{{ log[4] }}</span></td>
                                            <td>{{ log[5] }}</td>
                                            <td>{{ log[6] }}</td>
                                            <td>{{ log[7] }}</td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="8" class="text-center text-muted">No daily logs found</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Meal Logs View -->
                {% if view == 'meal_logs' %}
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Meal Logs</h1>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Username</th>
                                        <th>Meal</th>
                                        <th>Time</th>
                                        <th>Quantity</th>
                                        <th>Calories</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if meal_logs %}
                                        {% for log in meal_logs %}
                                        <tr>
                                            <td>{{ log[0] }}</td>
                                            <td><strong>{{ log[1] }}</strong></td>
                                            <td>{{ log[2] }}</td>
                                            <td>{{ log[3] }}</td>
                                            <td>{{ log[4] }}</td>
                                            <td><span class="badge bg-warning">{{ log[5] }}</span></td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="6" class="text-center text-muted">No meal logs found</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Activity Logs View -->
                {% if view == 'activity_logs' %}
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Activity Logs</h1>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Username</th>
                                        <th>Activity</th>
                                        <th>Time</th>
                                        <th>Duration (min)</th>
                                        <th>Calories Burned</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if activity_logs %}
                                        {% for log in activity_logs %}
                                        <tr>
                                            <td>{{ log[0] }}</td>
                                            <td><strong>{{ log[1] }}</strong></td>
                                            <td>{{ log[2] }}</td>
                                            <td>{{ log[3] }}</td>
                                            <td>{{ log[4] }}</td>
                                            <td><span class="badge bg-danger">{{ log[5] }}</span></td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="6" class="text-center text-muted">No activity logs found</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Goals View -->
                {% if view == 'goals' %}
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">User Goals</h1>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Username</th>
                                        <th>Goal Type</th>
                                        <th>Target</th>
                                        <th>Current</th>
                                        <th>Status</th>
                                        <th>Start Date</th>
                                        <th>Target Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if goals %}
                                        {% for goal in goals %}
                                        <tr>
                                            <td>{{ goal[0] }}</td>
                                            <td><strong>{{ goal[1] }}</strong></td>
                                            <td><span class="badge bg-primary">{{ goal[2] }}</span></td>
                                            <td>{{ goal[3] }}</td>
                                            <td>{{ goal[4] }}</td>
                                            <td>
                                                {% if goal[5] == 'Active' %}
                                                    <span class="badge bg-success">{{ goal[5] }}</span>
                                                {% elif goal[5] == 'Completed' %}
                                                    <span class="badge bg-info">{{ goal[5] }}</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">{{ goal[5] }}</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ goal[6] }}</td>
                                            <td>{{ goal[7] }}</td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="8" class="text-center text-muted">No goals found</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Add Meal View -->
                {% if view == 'add_meal' %}
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Add New Meal</h1>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Add Meal Form</h5>
                            </div>
                            <div class="card-body">
                                <form method="POST" action="{{ url_for('admin_add_meal') }}">
                                    <div class="mb-3">
                                        <label class="form-label">Meal Name</label>
                                        <input type="text" class="form-control" name="meal_name" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Meal Type</label>
                                        <select class="form-select" name="meal_type" required>
                                            <option value="">Select Type</option>
                                            <option value="Breakfast">Breakfast</option>
                                            <option value="Lunch">Lunch</option>
                                            <option value="Dinner">Dinner</option>
                                            <option value="Snack">Snack</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Calories</label>
                                        <input type="number" class="form-control" name="calories" step="0.01" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Protein (g)</label>
                                        <input type="number" class="form-control" name="protein" step="0.01" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Carbohydrates (g)</label>
                                        <input type="number" class="form-control" name="carbs" step="0.01" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Fats (g)</label>
                                        <input type="number" class="form-control" name="fats" step="0.01" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-plus-circle me-2"></i>Add Meal
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>All Meals</h5>
                            </div>
                            <div class="card-body" style="max-height: 600px; overflow-y: auto;">
                                {% if meals %}
                                    {% for meal in meals %}
                                    <div class="meal-item mb-2 p-2 border rounded">
                                        <strong>{{ meal[1] }}</strong> - {{ meal[2] }}
                                        <br>
                                        <small class="text-muted">
                                            Cal: {{ meal[3] }} | P: {{ meal[4] }}g | C: {{ meal[5] }}g | F: {{ meal[6] }}g
                                        </small>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">No meals added yet</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Add Activity View -->
                {% if view == 'add_activity' %}
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Add New Activity</h1>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Add Activity Form</h5>
                            </div>
                            <div class="card-body">
                                <form method="POST" action="{{ url_for('admin_add_activity') }}">
                                    <div class="mb-3">
                                        <label class="form-label">Activity Name</label>
                                        <input type="text" class="form-control" name="activity_name" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Activity Type</label>
                                        <select class="form-select" name="activity_type" required>
                                            <option value="">Select Type</option>
                                            <option value="Cardio">Cardio</option>
                                            <option value="Strength">Strength</option>
                                            <option value="Flexibility">Flexibility</option>
                                            <option value="Sports">Sports</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Calories Per Hour</label>
                                        <input type="number" class="form-control" name="calories_per_hour" step="0.01" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-plus-circle me-2"></i>Add Activity
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>All Activities</h5>
                            </div>
                            <div class="card-body" style="max-height: 600px; overflow-y: auto;">
                                {% if activities %}
                                    {% for activity in activities %}
                                    <div class="activity-item mb-2 p-2 border rounded">
                                        <strong>{{ activity[1] }}</strong> - {{ activity[2] }}
                                        <br>
                                        <small class="text-muted">{{ activity[3] }} calories/hour</small>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">No activities added yet</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
            </main>
        </div>
    </div>
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
</body>
</html>
